# üîí –°–ò–°–¢–ï–ú–ê –†–û–õ–ï–ô –ò –†–ê–ó–†–ï–®–ï–ù–ò–ô SMETA360

## üìä –¢–ï–ö–£–©–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –†–û–õ–ï–ô

### üóÉÔ∏è **–°–¢–†–£–ö–¢–£–†–ê –ë–ê–ó–´ –î–ê–ù–ù–´–•**

#### **–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**
```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
auth_users                 -- –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

-- –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π
user_roles                 -- –†–æ–ª–∏ (admin, manager, viewer –∏ —Ç.–¥.)  
permissions               -- –†–∞–∑—Ä–µ—à–µ–Ω–∏—è (projects.create, estimates.read –∏ —Ç.–¥.)
role_permissions          -- –°–≤—è–∑—å —Ä–æ–ª–µ–π –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (–º–Ω–æ–≥–∏–µ –∫–æ –º–Ω–æ–≥–∏–º)
user_role_assignments     -- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

-- –ú—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å
tenants                   -- –ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã/–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
user_tenants             -- –°–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ç–µ–Ω–∞–Ω—Ç–æ–≤
```

### üë• **–ü–†–ï–î–£–°–¢–ê–ù–û–í–õ–ï–ù–ù–´–ï –†–û–õ–ò**

#### **1. üî¥ super_admin (–°—É–ø–µ—Ä–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)**
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º —Å–∏—Å—Ç–µ–º—ã
- **–†–∞–∑—Ä–µ—à–µ–Ω–∏—è:** –í–°–ï —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã

#### **2. üîµ admin (–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)**  
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- **–†–∞–∑—Ä–µ—à–µ–Ω–∏—è:**
  - `projects.manage` - –ü–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏
  - `estimates.*` - –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ —Å–º–µ—Ç–∞–º–∏  
  - `materials.create/read/update` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏
  - `works.create/read/update` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–º–∏
  - `object_parameters.*` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –æ–±—ä–µ–∫—Ç–æ–≤
  - `users.read/update` - –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### **3. üü¢ project_manager (–ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤)**
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –∏ —Å–º–µ—Ç–∞–º–∏  
- **–†–∞–∑—Ä–µ—à–µ–Ω–∏—è:**
  - `projects.create/read/update` - –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏
  - `estimates.create/read/update/export` - –†–∞–±–æ—Ç–∞ —Å–æ —Å–º–µ—Ç–∞–º–∏
  - `materials.read` - –ü—Ä–æ—Å–º–æ—Ç—Ä –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
  - `works.read` - –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞–±–æ—Ç  
  - `object_parameters.create/read/update` - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—ä–µ–∫—Ç–æ–≤

#### **4. üü° estimator (–°–º–µ—Ç—á–∏–∫)**
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–º–µ—Ç
- **–†–∞–∑—Ä–µ—à–µ–Ω–∏—è:**
  - `projects.read` - –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤
  - `estimates.create/read/update/export` - –ü–æ–ª–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å–æ —Å–º–µ—Ç–∞–º–∏
  - `materials.read` - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
  - `works.read` - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ —Ä–∞–±–æ—Ç
  - `object_parameters.read` - –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤

#### **5. ‚ö™ viewer (–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å)**
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö
- **–†–∞–∑—Ä–µ—à–µ–Ω–∏—è:**
  - `projects.read` - –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤
  - `estimates.read` - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–º–µ—Ç
  - `materials.read` - –ü—Ä–æ—Å–º–æ—Ç—Ä –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤  
  - `works.read` - –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞–±–æ—Ç
  - `object_parameters.read` - –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤

### üõ°Ô∏è **–°–ò–°–¢–ï–ú–ê –†–ê–ó–†–ï–®–ï–ù–ò–ô**

#### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π: `resource.action`**

**üìÅ –ü—Ä–æ–µ–∫—Ç—ã (projects):**
- `create` - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
- `read` - –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤  
- `update` - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤
- `delete` - –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤
- `manage` - –ü–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏

**üìã –°–º–µ—Ç—ã (estimates):**
- `create` - –°–æ–∑–¥–∞–Ω–∏–µ —Å–º–µ—Ç
- `read` - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–º–µ—Ç
- `update` - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–º–µ—Ç  
- `delete` - –£–¥–∞–ª–µ–Ω–∏–µ —Å–º–µ—Ç
- `export` - –≠–∫—Å–ø–æ—Ä—Ç —Å–º–µ—Ç

**üß± –ú–∞—Ç–µ—Ä–∏–∞–ª—ã (materials):**
- `create` - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
- `read` - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
- `update` - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
- `delete` - –£–¥–∞–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

**üî® –†–∞–±–æ—Ç—ã (works):**
- `create` - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç  
- `read` - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ —Ä–∞–±–æ—Ç
- `update` - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç
- `delete` - –£–¥–∞–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç

**üèóÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—ä–µ–∫—Ç–æ–≤ (object_parameters):**
- `create` - –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤
- `read` - –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤  
- `update` - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤
- `delete` - –£–¥–∞–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤

**üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (users):**
- `create` - –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `read` - –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `update` - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `delete` - –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
- `manage_roles` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**‚öôÔ∏è –°–∏—Å—Ç–µ–º–∞ (system):**
- `audit` - –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∞—É–¥–∏—Ç–∞
- `backup` - –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
- `settings` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

### üîß **API ENDPOINTS –î–õ–Ø –†–û–õ–ï–ô**

#### **GET `/api/roles`** 
```bash
# –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ä–æ–ª–µ–π
curl -H "Authorization: Bearer TOKEN" http://localhost:3001/api/roles
```

#### **GET `/api/users/:userId/roles`**
```bash  
# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl -H "Authorization: Bearer TOKEN" http://localhost:3001/api/users/6/roles
```

### üîí **MIDDLEWARE –ò –ü–†–û–í–ï–†–ö–ê –î–û–°–¢–£–ü–ê**

#### **requireRole() Middleware:**
```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
app.get('/admin-only', requireRole(['admin', 'super_admin']), (req, res) => {
  // –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ –∏ —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–æ–≤
});
```

#### **tenantContextMiddleware:**
```javascript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ç–µ–Ω–∞–Ω—Ç–∞
// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç app.user_id –∏ app.tenant_id –≤ –ë–î –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
```

### üë®‚Äçüíº **–î–ï–ú–û-–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò**

#### **–¢–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã —Å —Ä–æ–ª—è–º–∏:**
```
admin@smeta360.ru / password123      (–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)
manager@smeta360.ru / password123    (–ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤) 
estimator@smeta360.ru / password123  (–°–º–µ—Ç—á–∏–∫)
viewer@smeta360.ru / password123     (–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å)
kiy026@yandex.ru / Apsni09332       (–¢–µ–∫—É—â–∏–π —Ç–µ—Å—Ç–æ–≤—ã–π - –ë–ï–ó —Ä–æ–ª–∏)
```

### ‚ö†Ô∏è **–¢–ï–ö–£–©–ò–ï –ü–†–û–ë–õ–ï–ú–´**

1. **üî¥ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–æ–ª–µ–π —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `kiy026@yandex.ru` –Ω–µ –∏–º–µ–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö —Ä–æ–ª–µ–π
   - API `/api/users/6/roles` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ []

2. **üü° –ù–µ–ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è middleware**  
   - `requireRole()` –µ—Å—Ç—å, –Ω–æ –Ω–µ –≤–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
   - –ú–Ω–æ–≥–∏–µ API endpoints –Ω–µ –∑–∞—â–∏—â–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–æ–ª–µ–π

3. **üü† –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ–ª—è–º–∏**
   - –ù–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
   - –ù–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### ‚úÖ **–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò**

1. **–ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º**
2. **–î–æ–±–∞–≤–∏—Ç—å middleware –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–µ–π –Ω–∞ –≤—Å–µ –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ endpoints**  
3. **–°–æ–∑–¥–∞—Ç—å UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ–ª—è–º–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏**
4. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)**

---
*–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞: 2 –æ–∫—Ç—è–±—Ä—è 2025*  
*–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã: SMETA360 v2.3.0*