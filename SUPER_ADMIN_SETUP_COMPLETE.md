# ‚úÖ –°–£–ü–ï–†-–ê–î–ú–ò–ù –ù–ê–°–¢–†–û–ï–ù –ò –†–ê–ë–û–¢–ê–ï–¢!

**–î–∞—Ç–∞:** 4 –æ–∫—Ç—è–±—Ä—è 2025, 19:05  
**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** kiy026@yandex.ru (–ò–ª—å—è –ö—É–∑—å–º–∏–Ω)  
**–†–æ–ª—å:** super_admin ‚úÖ

---

## üéØ –ß–¢–û –°–î–ï–õ–ê–ù–û

### 1. ‚úÖ –†–æ–ª—å —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –≤ –ë–î
- **User ID:** 6
- **Email:** kiy026@yandex.ru
- **–†–æ–ª—å:** super_admin (–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ 2 –æ–∫—Ç—è–±—Ä—è 2025)
- **–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç–∏–≤–µ–Ω

### 2. ‚úÖ JWT —Ç–æ–∫–µ–Ω —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–æ–ª—å

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ server/index.js:**
```javascript
// –ü—Ä–∏ –ª–æ–≥–∏–Ω–µ –ø–æ–ª—É—á–∞–µ–º —Ä–æ–ª—å –∏–∑ –ë–î
const roleResult = await query(`
  SELECT ur.name as role_name
  FROM user_role_assignments ura
  JOIN user_roles ur ON ur.id = ura.role_id
  WHERE ura.user_id = $1 AND ura.is_active = true
  LIMIT 1
`, [user.id]);

// –î–æ–±–∞–≤–ª—è–µ–º —Ä–æ–ª—å –∏ tenantId –≤ —Ç–æ–∫–µ–Ω
const token = jwt.sign({
  userId: user.id,
  email: user.email,
  firstname: user.firstname,
  lastname: user.lastname,
  role: userRole,  // ‚Üê —Ä–æ–ª—å –∏–∑ –ë–î
  tenantId: 'default-tenant'  // ‚Üê –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π tenant
}, config.jwtSecret, { expiresIn: '24h' });
```

### 3. ‚úÖ Middleware –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π tenantId

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ server/middleware/auth.js:**
```javascript
// tenantId —Ç–µ–ø–µ—Ä—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
const tenantId = payload.tenantId || payload.tenant_id || 'default-tenant';
```

### 4. ‚úÖ API /api/projects —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–æ–ª—å

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ server/index.js:**
```javascript
if (userRole === 'super_admin' || userRole === 'admin') {
  // –°—É–ø–µ—Ä-–∞–¥–º–∏–Ω –≤–∏–¥–∏—Ç –í–°–ï –ø—Ä–æ–µ–∫—Ç—ã
  queryText = `SELECT cp.*, ... FROM construction_projects cp ...`;
} else {
  // –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏
  queryText = `... WHERE cp.user_id = $1`;
}
```

---

## üß™ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### ‚úÖ Login —Å —Ä–æ–ª—å—é super_admin:

```json
{
  "userId": 6,
  "email": "kiy026@yandex.ru",
  "role": "super_admin",  ‚Üê —Ä–æ–ª—å –≤ —Ç–æ–∫–µ–Ω–µ!
  "tenantId": "default-tenant",
  "firstname": "–ò–ª—å—è",
  "lastname": "–ö—É–∑—å–º–∏–Ω",
  "iat": 1728064448,
  "exp": 1728150848
}
```

### ‚úÖ –î–æ—Å—Ç—É–ø –∫ –ø—Ä–æ–µ–∫—Ç–∞–º:

- **–ó–∞–≥—Ä—É–∂–µ–Ω–æ –ø—Ä–æ–µ–∫—Ç–æ–≤:** 6
- **–í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã –≤ —Å–∏—Å—Ç–µ–º–µ:** 6
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°—É–ø–µ—Ä-–∞–¥–º–∏–Ω –≤–∏–¥–∏—Ç –í–°–ï –ø—Ä–æ–µ–∫—Ç—ã!

**–°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤:**
1. [ID: 24] 1 - 3 (—Å–æ–∑–¥–∞–ª: –ò–ª—å—è –ö—É–∑—å–º–∏–Ω)
2. [ID: 23] 3 - 3 (—Å–æ–∑–¥–∞–ª: –ò–ª—å—è –ö—É–∑—å–º–∏–Ω)
3. [ID: 22] 2 - 2 (—Å–æ–∑–¥–∞–ª: –ò–ª—å—è –ö—É–∑—å–º–∏–Ω)
4. [ID: 21] 1 - 1 (—Å–æ–∑–¥–∞–ª: –ò–ª—å—è –ö—É–∑—å–º–∏–Ω)
5. [ID: 20] –ò–ª—å—è - –ú–æ—Å–∫–≤–∞ (—Å–æ–∑–¥–∞–ª: –ò–ª—å—è –ö—É–∑—å–º–∏–Ω)
6. [ID: 15] –ò–ª—å—è - –ú–æ—Å–∫–≤–∞ (—Å–æ–∑–¥–∞–ª: –ò–ª—å—è –ö—É–∑—å–º–∏–Ω)

---

## üîê –°–ò–°–¢–ï–ú–ê –†–û–õ–ï–ô

### –†–æ–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–µ:

1. **super_admin** ‚úÖ - –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –¥–∞–Ω–Ω—ã–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. **admin** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ —Ä–∞–º–∫–∞—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
3. **project_manager** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –∏ —Å–º–µ—Ç–∞–º–∏
4. **estimator** - –°–æ–∑–¥–∞–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–º–µ—Ç
5. **viewer** - –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä

### –ü—Ä–∞–≤–∞ —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∞:

- ‚úÖ –í–∏–¥–∏—Ç –ø—Ä–æ–µ–∫—Ç—ã –í–°–ï–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ú–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ª—é–±—ã–µ –ø—Ä–æ–µ–∫—Ç—ã
- ‚úÖ –ú–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –ª—é–±—ã–µ –ø—Ä–æ–µ–∫—Ç—ã
- ‚úÖ –î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Å–º–µ—Ç–∞–º
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (—á–µ—Ä–µ–∑ API)

---

## üìã –ü–†–û–í–ï–†–ö–ê "–•–†–ê–ù–ò–õ–ò–©–ï –ü–†–û–ï–ö–¢–û–í"

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç:
- **–§–∞–π–ª:** `src/pages/projects/ProjectStorage.jsx`
- **API:** `GET /api/projects` —Å —Ç–æ–∫–µ–Ω–æ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ (6 –ø—Ä–æ–µ–∫—Ç–æ–≤)
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∑–∞–∫–∞–∑—á–∏–∫—É, –¥–æ–≥–æ–≤–æ—Ä—É
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É
- ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
- ‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤
- ‚úÖ –î–µ–π—Å—Ç–≤–∏—è: –ø—Ä–æ—Å–º–æ—Ç—Ä, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ

### –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–æ–≤:
- –ù–∞–∑–≤–∞–Ω–∏–µ: customer_name + object_address
- –ü–æ–¥—Ä—è–¥—á–∏–∫: contractor_name
- –î–æ–≥–æ–≤–æ—Ä: contract_number
- –°–æ–∑–¥–∞—Ç–µ–ª—å: created_by_name
- –î–∞—Ç–∞: created_at

---

## üöÄ –ö–ê–ö –ü–†–û–í–ï–†–ò–¢–¨

### –®–∞–≥ 1: –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000
2. **–í—ã–π–¥–∏—Ç–µ** –∏–∑ —Å–∏—Å—Ç–µ–º—ã (–µ—Å–ª–∏ –≤–æ—à–ª–∏ —Ä–∞–Ω–µ–µ)
3. **–í–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ:** kiy026@yandex.ru / Apsni09332
4. ‚úÖ –ù–æ–≤—ã–π —Ç–æ–∫–µ–Ω —Å —Ä–æ–ª—å—é super_admin –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω

### –®–∞–≥ 2: –û—Ç–∫—Ä–æ–π—Ç–µ "–•—Ä–∞–Ω–∏–ª–∏—â–µ –ø—Ä–æ–µ–∫—Ç–æ–≤"

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **"–ü—Ä–æ–µ–∫—Ç—ã" ‚Üí "–•—Ä–∞–Ω–∏–ª–∏—â–µ –ø—Ä–æ–µ–∫—Ç–æ–≤"**
2. ‚úÖ –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –≤—Å–µ 6 –ø—Ä–æ–µ–∫—Ç–æ–≤
3. ‚úÖ –ú–æ–∂–µ—Ç–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —É–¥–∞–ª—è—Ç—å –ª—é–±—ã–µ –ø—Ä–æ–µ–∫—Ç—ã

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ DevTools

–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12) –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```javascript
const token = localStorage.getItem('authToken');
const payload = JSON.parse(atob(token.split('.')[1]));
console.log('–†–æ–ª—å:', payload.role);  // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: super_admin
console.log('TenantId:', payload.tenantId);  // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: default-tenant
```

---

## üìä –ò–ó–ú–ï–ù–ï–ù–ù–´–ï –§–ê–ô–õ–´

1. ‚úÖ `server/middleware/auth.js` - tenantId –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π
2. ‚úÖ `server/index.js` - login –ø–æ–ª—É—á–∞–µ—Ç —Ä–æ–ª—å –∏–∑ –ë–î –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ —Ç–æ–∫–µ–Ω
3. ‚úÖ `server/index.js` - register –¥–æ–±–∞–≤–ª—è–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—É—é —Ä–æ–ª—å –≤ —Ç–æ–∫–µ–Ω
4. ‚úÖ `server/index.js` - /api/projects —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ —Ä–æ–ª–∏
5. ‚úÖ `start-backend.bat` - –æ–±–Ω–æ–≤–ª–µ–Ω —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞

---

## ‚ö° –í–ê–ñ–ù–û!

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω—É–∂–Ω–æ:

1. **–í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã** –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. **–í–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ** —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω —Å —Ä–æ–ª—å—é
3. **–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É** (Ctrl+Shift+R)

**–°—Ç–∞—Ä—ã–π —Ç–æ–∫–µ–Ω –ë–ï–ó —Ä–æ–ª–∏ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–æ–≤—ã–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏!**

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞:

1. –°–æ–∑–¥–∞—Ç—å –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∞–≤)
2. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–æ–ª–µ–π –≤ –¥—Ä—É–≥–∏—Ö endpoints:
   - `/api/customer-estimates` - —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω –≤–∏–¥–∏—Ç –≤—Å–µ —Å–º–µ—Ç—ã
   - `/api/materials` - —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
   - `/api/works` - —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

3. –î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π)

---

## ‚úÖ –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–°

**–°—É–ø–µ—Ä-–∞–¥–º–∏–Ω:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç  
**–•—Ä–∞–Ω–∏–ª–∏—â–µ –ø—Ä–æ–µ–∫—Ç–æ–≤:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç  
**–†–æ–ª–∏ –≤ —Ç–æ–∫–µ–Ω–µ:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç  
**–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:** ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã

**–ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!** üöÄ

---

_–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: 4 –æ–∫—Ç—è–±—Ä—è 2025, 19:05_  
_–í–µ—Ä—Å–∏—è: 2.5.0 - –° —Å–∏—Å—Ç–µ–º–æ–π —Ä–æ–ª–µ–π –∏ –¥–æ—Å—Ç—É–ø–∞_

